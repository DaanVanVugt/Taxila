<script>

  function redrawWorkflowDiagram (){
    cy.resize();  //recalculate the viewport bounds
    cy.fit(); // refit all nodes and edges in the graph diagram
  }

  $(document).ready(function () {
    Split(['#workflow-diagram-content', '#workflow-diagram-sidebar'], {
      direction: 'horizontal',
      sizes: [70, 30],
      minSize: [400, 300],
      onDragEnd: function() {
        redrawWorkflowDiagram();
      }
    });

    redrawWorkflowDiagram(); // when document is loaded - for some reason not all nodes fit onto the diagram so redraw
  });

  // Redraw the workflow diagram when window is resized
  $(window).resize(function() {
    redrawWorkflowDiagram();
  });

</script>

<div class="wrapper collapsing-wrapper">
  <div id="content">
    <div class="row">
      <div class="content_action">
        <%= link_to t('.back', :default => t("helpers.links.back")),
                    :back, :class => 'btn btn-info' %>
        <% if !current_user.nil? and policy(@workflow).update? %>
            <%= link_to t('.edit', :default => t("helpers.links.edit")),
                        edit_workflow_path(@workflow), :class => 'btn btn-primary' %>
        <% end %>
        <% if !current_user.nil? and policy(@workflow).destroy? %>
            <%= link_to t('.destroy', :default => t("helpers.links.destroy")),
                        workflow_path(@workflow),
                        :method => 'delete',
                        :data => {:confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?'))},
                        :class => 'btn btn-danger' %>
        <% end %>
      </div>
    </div>
    <h2><%= t '.title', :default => @workflow.title %></h2>

    <div class="workflow-diagram-container" style="height: 650px;"> 
      <div id="workflow-diagram-content" class="split split-horizontal"> 
        <%= render partial: 'workflows/workflow_diagram', locals: {workflow: @workflow} %> 
      </div>
      <div id="workflow-diagram-sidebar" class="split split-horizontal"> 
        <h3 class="nav-heading" id="workflow-diagram-sidebar-title"> 
          <i class="fa fa-sitemap"></i> <%= @workflow.title %>  </h3> 
        <div id="workflow-diagram-sidebar-desc"> 
          <% if @workflow.description.blank? %>
               <p class="muted">No description provided</p> 
          <% else %> 
              <p><%= render_markdown(@workflow.description) %></p> 
          <% end %> 
        </div>
      </div>
    </div>
  </div>
</div>
