<%# Sidebar containing filterable facets.

Parameters:
- resources     - SOLR object containing results and metadata about search as returned from materials#index

Variable that should be available
- @facet_params  - The facet filters the user has applied
%>
<h3 class="nav-heading" id="sidebar-header">
  <i class="fa fa-filter"></i> Filters
  <button href="#" class="btn btn-link pull-right" id="sidebar-close"><i class="icon-lg icon cross-icon icon-invert"></i></button>
</h3>

<%
  extras = if resource_type.name == 'Event'
             [['Most recent', 'new'], ['Earliest', 'early'], ['Latest', 'late']]
           elsif resource_type.name == 'Source'
             [['Most recent', 'new'], ['Last finished', 'finished']]
           else
             [['Most recent', 'new']]
           end %>

<%= render partial: 'search/common/sort_by', locals: { resources: resource_type, extras: extras } %>

<ul class="unstyled nav-simple">
  <li>
    <h3>Filter<i class="icon icon-md clear-filters-icon pull-right"></i><span class="font-size-sm pull-right"><%= link_to clear_filters_path, class: 'no-link' do %>clear filters<% end %></span></h3>
  </li>
  <% if current_user && (current_user.is_curator? || current_user.is_admin?) %>
    <%= render partial: 'search/common/facet_sidebar_curation', locals: { resource_type: resource_type } %>
  <% end %>
  <% if ['Event', 'Material'].include?(resource_type.name) %>
    <%= render partial: 'search/common/facet_sidebar_max_age' %>
  <% end %>
  <% resources.facets.select { |f| f.rows.any? }.each do |facet| %>
      <% if IGNORED_FILTERS.include?(facet.field_name.to_s)   %>
      <% elsif facet.field_name == :online %>
      <% elsif facet.field_name == :include_expired %>


      <% else %>
        <%= render partial: 'search/common/facet_sidebar_filter',
                 locals: { facet: facet, resources: resources } %>
      <% end %>
  <% end %>

  <% resources.facets.select { |f| f.rows.any? }.each do |facet| %>
    <% if facet.field_name == :online %>
      <%= render partial: 'search/common/facet_sidebar_boolean_filter',
                 locals: { facet: facet, resources: resources } %>
    <% end %>

  <% end %>

  <% if ['Event'].include?(resource_type.name) %>
    <% include_expired = @facet_params.delete('include_expired') %>
    <% if include_expired %>
      <% button_params = search_and_facet_params %>
      <% button_params.delete(:include_expired) %>
      <% button_text = "Hide" %>
    <% else %>
      <% button_text = "Show" %>
      <% button_params = search_and_facet_params.merge(include_expired: true) %>
    <% end %>
    <div class="toggle-wrap">
      <%= link_to button_params do %>
        <li class="nav-item">
          <label class="toggle">
            <input type="checkbox"<%= ' checked' if include_expired -%>>
            <span class="slider round"></span>
          </label>
          <%= button_text %> past events
        </li>
      <% end %>
    </div>
  <% end %>
</ul>
