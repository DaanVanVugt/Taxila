<script>
  $(document).ready(function () {
    reposition_tiles('masonry', 'masonry-brick');
    $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
      reposition_tiles('masonry', 'masonry-brick');
    })
  })
</script>

<%- model_class = Node -%>

<div class="row wrapper">

  <!-- SIDEBAR -->
  <div class="col-md-3" id="sidebar">
    <%= render :partial => "nodes/partials/node_info", :locals => {:node => @node} %>
  </div>

  <div class=" col-md-9">
    <div class="row" style="padding: 10px 5px 0px 0px;">
      <div>
        <h2 style="margin-top: 0px;">
          <%= image_tag get_image_url_for(@node), :class=>"media-image listing_image" %>
          <%=t '.title', :default => @node.name %>
        </h2>
      </div>
      <div class="content_action" style="margin-top: -50px;">
        <%= link_to t('.back', :default => t("helpers.links.back")),
                    :back, :class => 'btn btn-info'  %>
        <% if !current_user.nil? and policy(@node).update? %>
            <%= link_to t('.edit', :default => t("helpers.links.edit")),
                        edit_node_path(@node), :class => 'btn btn-primary' %>
        <% end %>
        <% if !current_user.nil? and policy(@node).destroy? %>
            <%= link_to t('.destroy', :default => t("helpers.links.destroy")),
                        node_path(@node),
                        :method => 'delete',
                        :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) },
                        :class => 'btn btn-danger' %>
        <% end %>
        <% unless @node.home_page.blank? %>
            <a href="<%= @node.home_page %>" target="_blank" type="submit" class="btn btn-success">
              <span class="fa fa-external-link"></span> View home page
            </a>
        <% end %>
      </div>
    </div>
    <div class="row">
      <ul class="nav nav-tabs">
        <li class="active">
          <a data-toggle="tab" href="#providers"><i class="<%= icon_class_for_model('providers') %>"></i> Providers</a>
        </li>
        <li>
          <a data-toggle="tab" href="#materials"><i class="<%= icon_class_for_model('materials') %>"></i> Materials</a>
        </li>
        <li>
          <a data-toggle="tab" href="#events"><i class="<%= icon_class_for_model('events') %>"></i> Events</a>
        </li>
        <li>
          <a data-toggle="tab" href="#activity_log"><i class="<%= icon_class_for_model('activity_logs') %>"></i> Activity log</a>
        </li>
      </ul>

      <div class="tab-content">
        <div id="providers" class="tab-pane fade in active">
          <div class="row">
            <div class="search-results-count"> 
              <% providers = @node.content_providers %>
              <%= pluralize(providers.count, 'content provider') %> found 
            </div>
            <% if !providers.blank? %>
                <% providers.each do |provider| %> 
                    <%= render provider %> 
                <% end %> 
            <% end %>
          </div>
        </div>
        <div id="materials" class="tab-pane fade">
          <div class="row">
            <div class="search-results-count"> 
              <% materials = materials_for(@node) %>
              <%= pluralize(materials.count, 'training material') %> found 
            </div>
            <% if !materials.blank? %>
                <% materials.each do |material| %> 
                    <%= render material %> 
                <% end %> 
            <% end %>
          </div>
        </div>
        <div id="events" class="tab-pane fade">
          <div class="row">
            <div class="search-results-count"> 
              <% events = events_for(@node) %>
              <%= pluralize(events.count, 'event') %> found 
            </div>
            <% if !events.blank? %>
                <% events.each do |event| %> 
                    <%= render event %> 
                <% end %> 
            <% end %>
          </div>
        </div>
        <div id="activity_log" class="tab-pane fade">
          <%= render :partial => "activities/activity_log", :locals => {:resource => @node} %>
        </div>
      </div>
    </div>
  </div>
</div>
