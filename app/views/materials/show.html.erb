<script>
    $(document).ready(function () {
        reposition_tiles('masonry', 'masonry-brick');
        $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
            reposition_tiles('masonry', 'masonry-brick');
        })
    })
</script>

<%- model_class = Material -%>

<div class="row wrapper">
  <!-- SIDEBAR -->
  <div class="col-md-3" id="sidebar">
    <%= render :partial => "content_providers/partials/content_provider_info", :locals => {:content_provider => @material.content_provider} %>
  </div>

  <div class=" col-md-9">
    <div class="row" style="padding: 10px 5px 0px 0px;">
      <div class="content_action">
        <%= link_to t('.back', :default => t("helpers.links.back")),
                    :back, :class => 'btn btn-info'  %>
        <% if !current_user.nil? and policy(@material).update? %>
            <%= link_to t('.edit', :default => t("helpers.links.edit")),
                        edit_material_path(@material), :class => 'btn btn-primary' %>
        <% end %>
        <% if !current_user.nil? and policy(@material).destroy? %>
            <%= link_to t('.destroy', :default => t("helpers.links.destroy")),
                        material_path(@material),
                        :method => 'delete',
                        :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) },
                        :class => 'btn btn-danger' %>
        <% end %>
        <a href="<%= @material.url %>" target="_blank" type="submit" class="btn btn-success"><span class="fa fa-external-link"></span> View material</a>
      </div>
    </div>
    <div class="row">
      <ul class="nav nav-tabs">
        <li class="active">
          <a data-toggle="tab" href="#home"><i class="<%= icon_class_for_model('materials') %>"></i> Material</a></li>
        <li>
          <a data-toggle="tab" href="#packages"><i class="<%= icon_class_for_model('packages') %>"></i> Packages</a>
        </li>
        <li>
          <a data-toggle="tab" href="#activity_log"><i class="<%= icon_class_for_model('activity_logs') %>"></i> Activity log</a>
        </li>
      </ul>

      <div class="tab-content">
        <div id="home" class="tab-pane fade in active">
          <div itemscope itemtype="https://schema.org/CreativeWork">
            <div class="row">
              <div class="page-header dont-break-out">
                <h2 itemprop="name"><%=t '.title', :default => @material.title %></h2>
                <p><%= link_to @material.url, @material.url, :class =>'h5', :target => "_blank" %></p>
                <% if not @material.long_description.blank? %>
                    <p><%= render_markdown(@material.long_description) %></p>
                <% elsif not @material.short_description.blank? %>
                    <p><%= render_markdown(@material.short_description)%></p>
                <% end %>
              </div>
              <div>
                <p><b><%= model_class.human_attribute_name(:scientific_topics).pluralize %>: </b><%= @material.scientific_topics.blank? ? empty_tag(:span, 'none specified') : @material.scientific_topics.map{|x| x.preferred_label}.join(', ') %></p>
                <p><b><%= model_class.human_attribute_name(:keywords) %>: </b><%= @material.keywords.blank? ? empty_tag(:span, 'none specified') : @material.keywords.join(', ') %></p>
                <p><b><%= model_class.human_attribute_name(:target_audience) %>: </b><%= @material.target_audience.blank? ? empty_tag(:span, 'none specified') : @material.target_audience.join(', ') %></p>
                <p><b><%= model_class.human_attribute_name(:difficulty_level) %>: </b><%= (@material.difficulty_level.blank? or @material.difficulty_level == 'notspecified') ? empty_tag(:span, 'none specified') : difficulty_name_for_abbreviation(@material.difficulty_level) %></p>
                <p><b><%= model_class.human_attribute_name(:licence) %>: </b><%= (@material.licence.blank? or @material.licence == 'notspecified') ? empty_tag(:span, 'none specified') : licence_name_for_abbreviation(@material.licence) %></p>

                <p>
                  <b><%= model_class.human_attribute_name(:authors) %>: </b>
                  <% if @material.authors.blank? -%>
                    <% empty_tag(:span, 'none specified') -%>
                  <% else -%>
                      <% @material.authors.each do |auth| -%>
                        <%= content_tag(:span, auth, {:itemprop => 'author', :itemtype => 'https://schema.org/Person'})  -%><% unless auth == @material.authors.last -%>,<% end -%>
                      <% end -%>
                  <% end -%>
                </p>

                <p>
                  <b><%= model_class.human_attribute_name(:contributors) %>: </b>
                  <% if @material.contributors.blank? -%>
                    <% empty_tag(:span, 'none specified') -%>
                  <% else -%>
                      <% @material.contributors.each do |contrib| -%>
                        <%= content_tag(:span, contrib, {:itemprop => 'contributor', :itemtype => 'https://schema.org/Person'})  -%><% unless contrib == @material.contributors.last -%>,<% end -%>
                      <% end -%>
                  <% end -%>
                </p>

                <p><b>DOI: </b><%= @material.doi.blank? ? empty_tag(:span, 'none specified') : @material.doi %></p>

                <p><b>Created: </b>
                  <% if @material.remote_created_date.blank? -%>
                      <%= empty_tag(:span, 'none specified') -%>
                  <% else -%>
                      <%= content_tag(:span, @material.remote_created_date, {:itemprop => 'dateCreated'}) -%>
                  <% end -%>
                </p>

                <p><b>Last updated: </b>
                  <% if @material.remote_updated_date.blank? -%>
                      <%= empty_tag(:span, 'none specified') -%>
                  <% else -%>
                      <%= content_tag(:span, @material.remote_updated_date, {:itemprop => 'dateModified'}) -%>
                  <% end -%>
                </p>


              </div>
            </div>
          </div>
        </div>
        <div id="packages" class="tab-pane fade">
          <% if current_user and policy(@material).update? %>
          <div class="row">
            <%= form_tag(controller: 'materials', id: @material.id, action: 'update_packages', method: 'post') do |f| %>
                <%= render :partial => 'common/dropdown', :locals => {:field_name => 'package', :resource => @material, :f => f, :options => available_packages_for_material(@material)} %>
                <button type="submit" value="add" class="btn btn-primary">Update material</button>
            <% end %>
          </div>
          <% end %>
          <div class="row">
            <% if @material.packages.blank? %>
                <%= empty_tag(:p, 'This material is currently not included in any packages.', "padding-top: 10px;") %>
            <% else %>
                <ul class="masonry media-grid">
                  <% @material.packages.each do |package| %>
                      <%= render :partial => "packages/package", :locals => {:package => package} %>
                  <% end %>
                </ul>
            <% end %>
          </div>
        </div>
        <div id="activity_log" class="tab-pane fade">
          <%= render :partial => "activities/activity_log", :locals => {:resource => @material} %>
          <!--<%#= link_to(material_activities_path(@material)) %>-->
        </div>
      </div>
    </div>
  </div>
</div>