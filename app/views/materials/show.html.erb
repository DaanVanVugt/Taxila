<div class="wrapper collapsing-wrapper">
  <div class="collapsing-sidebar" id="sidebar">
    <%= render partial: 'content_providers/partials/content_provider_info', locals: { content_provider: @material.content_provider } %>
    <%= render partial: 'nodes/partials/associated_node_info', locals: { associated_nodes: @material.associated_nodes } %>
    <%= render(partial: 'users/partials/user_info', locals: { user: @material.user }) if current_user.try(:is_admin?) %>
  </div>

  <div id="content">
    <div id="home" class="row">
      <div>
        <!-- Field: title -->
        <div class="sub-heading"><%= display_attribute_no_label(@material, :resource_type) { |values| values.join(', ') } %></div>
        <h2 class="mt-0">
          <%=t '.title', :default => @material.title %>
          <%= scrape_status_icon(@material, 'large') if current_user and current_user.is_admin? %>
          <%= missing_icon(@material, 'large') if current_user and current_user.is_admin? %>
          <%= suggestion_icon(@material, 'large') if current_user and current_user.is_admin? -%>
        </h2>

        <!-- Field: URL -->
        <p>
        <div class="url-wrap">
          <%= link_to @material.url, target: '_blank', rel: 'noopener',
                      onclick: "getOutboundLink('#{@material.url}'); return true;" do %>
            <%= @material.url %><i class="icon icon-md arrow-top-right-icon"></i>
          <% end %>
        </div>
        </p>

        <div class="row">

          <div class="content_action">
            <%= star_button(@material) if user_signed_in? %>

            <%= render partial: 'common/identifiers_dot_org_button', locals: { resource: @material } if TeSS::Config.identifiers_prefix %>

            <% if !current_user.nil? and policy(@material).update? %>
              <%= link_to t('.edit', :default => t("helpers.links.edit")),
                          edit_material_path(@material), :class => 'btn btn-primary' %>
            <% end %>

            <% if !current_user.nil? and policy(@material).destroy? %>
              <%= link_to t('.destroy', :default => t("helpers.links.destroy")),
                          material_path(@material),
                          :method => 'delete',
                          :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) },
                          :class => 'btn btn-danger' %>
            <% end %>
          </div>
        </div>

        <%= embed_youtube(@material) %>

        <!-- Field: long description -->
        <div class="description">
          <%= render_markdown @material.description %>
        </div>
      </div>

      <div>
        <!-- Other metadata -->
        <%= render partial: 'common/extra_metadata', locals: { resource: @material } %>

        <% if policy(@material).update? && @material.edit_suggestion %>
          <%= render partial: 'common/approve_term_suggestions', locals: { suggestion: @material.edit_suggestion } %>
        <% end %>

        <!-- Field: events -->
        <% if @material.events.any? %>
          <div>
            <b>Related events: </b>
            <ul>
              <% @material.events.not_finished.each do |event| %>
                <li><%= link_to event.title, event %></li>
              <% end %>
              <% @material.events.finished.each do |event| %>
                <li><%= link_to event.title, event %> (ended)</li>
              <% end %>
            </ul>
          </div>
        <% end %>

        <!-- Field: eternal resources -->
        <div>
          <% if @material.external_resources.any? %>
            <b>External resources: </b>
            <%= render partial: 'common/external_resources_list', locals: { external_resources: @material.external_resources} %>
          <% end %>
        </div>

        <%= render :partial => 'materials/partials/twitter_card', :locals => {:material => @material} %>
      </div>
    </div>
    <%= render partial: 'activities/activity_log_button', locals: { resource: @material } %>
  </div>
</div>
