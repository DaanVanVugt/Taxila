<% api_base = 'https://dev.bio.tools/api/tool' %>

<script>

    $(document).on('click', '.associate-tool', function (event) {
        obj = $(event.target);
        Materials.externalResources.add(obj.data('title'), obj.data('url'));
        obj.parent().parent().fadeOut();
    });

    $(document).on('click', '#next-tools-button', function (event) {
        var next_page = $(event.target).attr('data-next');
        query_api('<%=api_base %>' + next_page + '&' + query_parameter() + '&' + sort_parameter())
        return false
    });

    $(document).on('focusout', '#<%=title_element||''%>', function (event) {
        $('#biotools-results').empty();
        query_api('<%=api_base + '?'%>' + query_parameter() + '&' + sort_parameter());
    });

    $(function () {
        query_api('<%=api_base + '?'%>' + query_parameter() + '&' + sort_parameter());
    });

    function query_parameter() {
        return 'q=' + encodeURIComponent($('#<%=title_element||''%>').val());
    }
    function sort_parameter() {
        return 'sort=score';
    }

    function query_api(api_url) {
        console.log(api_url)
        $.get(api_url, function (json) {
            display_tools(json)
        })
    }

    function display_tools(json) {
        var items = json.list;
        console.log(json)
        $.each(items, function (index, item) {
            var url = 'https://dev.bio.tools/tool/' + item.id
            $('#biotools-results').append('' +
                    '<div id="' + item.id + '" class="col-md-12 col-sm-12" data-toggle=\"tooltip\" data-placement=\"top\" aria-hidden=\"true\" title=\"' + item.description + '\">' +
                    '<h4>' +
                    '<i class="fa fa-wrench"></i> ' +
                    '<a href="' + url + '">' +
                    '<span class="title">' +
                    item.name +
                    '</span>' +
                    '</a>' +
                    ' <i id="' + item.id + '" ' +
                    'class="fa fa-plus-square-o associate-tool"/ ' +
                    'title="click to associate ' + item.name + ' with this training material"' +
                    'data-title="' + item.name + '" data-url="' + url + '"/>' +
                    '</h4>' +
                    '<span>' + item.description + '</span>' +
                    '</div>');
        });
        $('#next-tools-button').attr('data-next', json.next);
    }

</script>

<div class="row event-info-icons">
  <h4>Suggested tools to associate with this resource</h4>
  <em>Data provided by <a href="http://bio.tools">ELIXIR Tools and Data Services Registry</a></em>

  <div id="biotools-results">
  </div>
  <br>

  <div class="load-more-results">
    <i id="next-tools-button" class="btn btn-primary pull-right">Load more results</i>
  </div>
</div>

