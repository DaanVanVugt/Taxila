<% api_base = 'https://dev.bio.tools/api/tool?' %>
<% query_parameter = 'q=' + URI.escape(@material.title) %>
<% score_sort = 'sort=score' %>
<script>
  String.prototype.hashCode = function(){
      var hash = 0;
      if (this.length == 0) return hash;
      for (i = 0; i < this.length; i++) {
          char = this.charCodeAt(i);
          hash = ((hash<<5)-hash)+char;
          hash = hash & hash; // Convert to 32bit integer
      }
      return hash;
  }

  $(document).on('click', '.associate-tool', function(event){
      obj = $(event.target);
      Materials.externalResources.add(obj.data('title'), obj.data('url'));
      obj.parent().parent().fadeOut();
  })

  $(function(){
        $.get('<%=api_base + query_parameter + '&' + score_sort%>', function(json){
            var items = json.list;
            $.each(items, function(index, item){
                var url = 'https://dev.bio.tools/tool/' + item.id
                $('#biotools-results').append('' +
                        '<div id="' + item.name + '" class="col-md-4 col-sm-6" data-toggle=\"tooltip\" data-placement=\"top\" aria-hidden=\"true\" title=\"'+ item.description +'\">' +
                            '<h4>' +
                                '<i class="fa fa-wrench"></i> ' +
                                '<a href="' + url + '">' +
                                    '<span class="title">' +
                                        item.name +
                                    '</span>' +
                                '</a>' +
                                ' <i id="' + item.name.hashCode() + '" ' +
                                        'class="fa fa-plus-square-o associate-tool"/ ' +
                                        'title="click to associate ' + item.name + ' with this training material"' +
                                        'data-title="' + item.name + '" data-url="' + url + '"/>' +
                            '</h4>' +
                            '<span>' + item.description.substring(0,150) + '...</span>' +

                        '</div>');
            });

            $('#next-button').data('next', json.next);
        })
    })

</script>

<div class="row event-info-icons">
  <h1>Suggested tools</h1>
  <div id="biotools-results">

  </div>

  <button type="button" id="next-button" class="btn btn-primary pull-right" >Next page</button>
</div>