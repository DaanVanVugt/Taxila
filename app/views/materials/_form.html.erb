<script>
$(document).ready(function(){
    $(document.body).on('click', '.add', function(e){
        var field_name = $(this).attr('data-field');
        add_one_list_item(field_name);
    })

    $(document.body).on('click', '.delete', function(e){
        var list_item = $(this).parent();
        remove_list_item(list_item)
    })

    $(document.body).on('keypress', '.multiple-input', function(e){
        /*ADD NEW LINE IF USER HITS ENTER. CONSIDER ADDING MORE LIKE SHIFT, COMMA, ETC*/
        if (e.which == '13') {
            var field_name = $(this).attr('data-field');
            add_one_list_item(field_name);
        }
    })

    function add_one_list_item(field_name){
        $('<div class="list-item">' +
        '<input type="text" class="form-control multiple-input" data-field="' + field_name + '" name="material[' +
        field_name + 's][]"/>' +
        '<input type="button" value="x" class="delete" data-field="keyword"/>' +
                '</div>').appendTo('.' + field_name).focus();
    }

    function remove_list_item(list_item){
        list_item.remove();
    }
})
</script>

<%= form_for @material, :html => {:class => "form-horizontal material"} do |f| %>

    <% if @material.errors.any? %>
        <div id="error_expl" class="panel panel-danger">
          <div class="panel-heading">
            <h3 class="panel-title"><%= pluralize(@material.errors.count, "error") %> prohibited this material from
              being saved:</h3>
          </div>
          <div class="panel-body">
            <ul>
              <% @material.errors.full_messages.each do |msg| %>
                  <li><%= msg %></li>$(document.body).on('click', '.delete', function(e){
              <% end %>
            </ul>
          </div>
        </div>
    <% end %>

    <div class="control-group">
      <%= f.label :title, :class => 'control-label' %>
      <div class="controls">
        <%= f.text_field :title, :class => 'form-control' %>
      </div>
      <%= error_span(@material[:title]) %>
    </div>
    <div class="control-group">
      <%= f.label :url, "URL", :class => 'control-label' %>
      <div class="controls">
        <%= f.text_field :url, :class => 'form-control' %>
      </div>
      <%= error_span(@material[:url]) %>
    </div>
    <div class="control-group">
      <%= f.label :short_description, :class => 'control-label' %>
      <div class="controls">
        <%= f.text_field :short_description, :class => 'form-control' %>
      </div>
      <%= error_span(@material[:short_description]) %>
    </div>
    <div class="control-group">
      <%= f.label :long_description, :class => 'control-label' %>
      <div class="controls">
        <%= f.text_field :long_description, :class => 'form-control' %>
      </div>
      <%= error_span(@material[:long_description]) %>
    </div>
    <div class="control-group">
      <%= f.label :doi, "DOI", :class => 'control-label' %>
      <div class="controls">
        <%= f.text_field :doi, :class => 'form-control' %>
      </div>
      <%= error_span(@material[:doi]) %>
    </div>
    <!--<div class="control-group">-->
    <!--<%#= f.label :remote_updated_date, :class => 'control-label' %>-->
    <!--<div class="controls">-->
    <!--<%#= f.text_field :remote_updated_date, :class => 'form-control' %>-->
    <!--</div>-->
    <!--<%#= error_span(@material[:remote_updated_date]) %>-->
    <!--</div>-->
    <!--<div class="control-group">-->
    <!--<%#= f.label :remote_created_date, :class => 'control-label' %>-->
    <!--<div class="controls">-->
    <!--<%#= f.text_field :remote_created_date, :class => 'form-control' %>-->
    <!--</div>-->
    <!--<%#= error_span(@material[:remote_created_date]) %>-->
    <!--</div>-->
    <div class="control-group">
      <%= f.label :scientific_topic, :class => 'control-label' %>
      <div class="controls">
        <%= f.text_field :scientific_topic, :class => 'form-control' %>
      </div>
      <%= error_span(@material[:scientific_topic]) %>
    </div>
    <div class="control-group">
      <%= f.label :target_audience, :class => 'control-label' %>
      <div class="controls">
        <%= f.text_field :target_audience, :class => 'form-control' %>
      </div>
      <%= error_span(@material[:target_audience]) %>
    </div>

    <div class="control-group">
      <%= f.label :keywords, :class => 'control-label' %>
        <div class="keyword controls">
            <% @material[:keywords].each do |keyword| %>
              <div class="list-item">
                <input type="text" class="form-control multiple-input" data-field='keyword' name="material[keywords][]" value="<%=keyword%>"/>
                <input type="button" value="x" class="delete" data-field="keyword"/>
              </div>
            <% end %>
        </div>
        <input type="button" class="add" data-field="keyword" value="+">
      <%= error_span(@material[:keywords]) %>
    </div>


    <div class="control-group">
      <%= f.label :licence, :class => 'control-label' %>
      <div class="controls">
        <%= f.select :licence, options_for_select(licence_options_for_select(), @material[:licence].blank? ? "notspecified" : @material[:licence]), :class => 'form-control' %>
      </div>
      <%= error_span(@material[:licence]) %>
    </div>

    <div class="control-group">
      <%= f.label :difficulty_level, :class => 'control-label' %>
      <div class="controls">
        <%= f.text_field :difficulty_level, :class => 'form-control' %>
      </div>
      <%= error_span(@material[:difficulty_level]) %>
    </div>


    <div class="control-group">
      <%= f.label :authors, :class => 'control-label' %>
      <div class="author controls">
        <% @material[:authors].each do |author| %>
            <div class="list-item">
              <input type="text" class="form-control multiple-input" data-field='author' name="material[authors][]" value="<%=author%>"/>
              <input type="button" value="x" class="delete" data-field="author"/>
            </div>
        <% end %>
      </div>
      <input type="button" class="add" data-field="author" value="+">
      <%= error_span(@material[:authors]) %>
    </div>

    <div class="control-group">
      <%= f.label :contributors, :class => 'control-label' %>
      <div class="contributor controls">
        <% @material[:contributors].each do |contributor| %>
            <div class="list-item">
              <input type="text" class="form-control multiple-input" data-field='contributor' name="material[contributors][]" value="<%=contributor%>"/>
              <input type="button" value="x" class="delete" data-field="contributor"/>
            </div>
        <% end %>
      </div>
      <input type="button" class="add" data-field="contributor" value="+">
      <%= error_span(@material[:contributors]) %>
    </div>

    <div class="control-group">
      <%= f.label :packages, :class => 'control-label' %>
      <div class="controls">
        <%= f.select "package_ids", content_tag(:option,'select one...',:value=>"")+options_from_collection_for_select(available_packages_for(@material), "id", "name") %>
      </div>
      <%= error_span(@material[:packages]) %>
    </div>

    <div class="control-group">
        <%= f.label :existing_packages, :class=> 'control-label' %>
      <div class="controls">
         <% packages = material_package_list(@material) %>
         <% if packages.empty? %>
            <div class="nonetext">None</div>
         <% else %>  
           <% material_package_list(@material).each do |p| %>
             <%= p.html_safe %>
            <% end %>
          <% end %>
      </div>
    </div>

    <div class="control-group">
      <%= f.label :content_provider, :class=> 'control-label' %>
      <div class="controls">
        <% content_provider = @material.content_provider %>
        <% if content_provider.nil? %>
            <%= f.select "content_provider_id", content_tag(:option,'select one...',:value=>"")+options_from_collection_for_select(ContentProvider.all, "id", "title") %>
        <% else %>
            <a href="<%=url_for content_provider %>">
              <%= content_provider.title %>
              <img src="<%= content_provider.logo_url %>"/>
            </a>
        <% end %>
      </div>
    </div>


    <%= f.submit nil, :class => 'btn btn-primary' %>
    <%= link_to t('.cancel', :default => t("helpers.links.cancel")),
                materials_path, :class => 'btn btn-default' %>

<% end %>
