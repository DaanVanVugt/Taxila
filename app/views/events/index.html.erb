<script>
  $(document).ready(function () {
      reposition_tiles('masonry', 'masonry-brick');
      $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
          /*Load map script only once when event tab is selected*/
          if (!loadedMapScript){
              $.getScript("https://maps.googleapis.com/maps/api/js?key=AIzaSyCT1w2S_2I49FwJDKHGj9A9sO86Lp9nUdg&callback=initialize")
          } else {
              $.getScript("https://www.gstatic.com/charts/loader.js")
          }
          reposition_tiles('masonry', 'masonry-brick');
      })
  })

</script>

<%- model_class = Package -%>

<!-- SIDEBAR | RESULTS -->
<div class="row wrapper">
  <% if SOLR_ENABLED %>

      <!-- SIDEBAR -->
      <div class="col-md-3" id="sidebar">
        <%= render :partial => "search/common/facet_sidebar", :locals => {:resources => @events, :resource_type => 'event'} %>
      </div>

      <!-- RESULTS -->
      <div class="col-md-9">

        <!-- CREATE NEW BUTTON -->
        <!-- DO NOT ALLOW CREATION OF EVENTS IN TeSS -->
        <!--<div class="row">-->
        <!--<%#= link_to new_event_path, :class => "btn btn-primary" do %>-->
        <!--<i class="fa fa-plus-square"></i> Create event-->
        <!--<#% end %>-->
        <!--</div>-->

        <!-- SEARCH BAR -->
        <div class="row">
          <%= render :partial => "search/common/search_box", :locals => {:resource_path => events_path} %>
        </div>

        <!-- NUMBER OF RESULTS -->
        <div class="row">
          <% include_expired = @facet_params.delete('include_expired') %>
          <div class="col-md-4">
            <%= render :partial => "search/common/search_info", :locals => {:resources => @events, :resource_type => 'event'} %>
          </div>
          <!-- INCUDE EXPIRED EVENTS -->
          <div class="col-md-4">
            <form class="form-inline" style="padding-top:3px;">
              <div class="form-group pull-right">
                <!--<div class="checkbox pull-right">-->
                <label class="checkbox-inline">
                  <% if include_expired %>
                      <% new_params = params.dup %>
                      <% new_params.delete(:include_expired) %>
                      <%= link_to new_params, class: 'btn btn-default' do %>
                          <i class="fa fa-clock-o"></i> Hide past events
                      <% end %>
                  <% else %>
                      <%= link_to params.merge(:include_expired => true), class: 'btn btn-default' do %>
                          <i class="fa fa-clock-o"></i> Show past events
                      <% end %>
                  <% end %>
                </label>
              </div>
            </form>
          </div>
          <!-- SORT BY OPTIONS    -->
          <div class="col-md-4">
            <%= render :partial => "search/common/sort_by",
                       :locals => {:resources => @events,
                                   :extras => [['Earliest', 'early'], ['Latest', 'late']]} %>
          </div>
        </div>

        <!-- APPLIED FILTERS -->
        <div class="row">
          <div class="col-md-12">
            <%= render :partial => "search/common/search_filters", :locals => {:resources => @events} %>
          </div>
        </div>

        <!-- PAGINATION -->
        <div class="row">
          <%= render :partial => "search/common/pagination_bar", :locals => {:resources => @events} unless (@events.blank? or @events.results.blank?) %>
        </div>

        <hr>
        <% @events = @events.results unless @events.blank? %>
  <% end %>

  <!-- ACTUAL RESULTS LIST -->
  <% unless @events.blank? %>

      <ul class="nav nav-tabs">
        <li class="active">
          <a data-toggle="tab" href="#home"><i class="fa fa-table"></i> Grid view</a></li>
        <li>
          <a data-toggle="tab" href="#map"><i class="fa fa-globe"></i> Map view</a></li>
        <li>
          <a data-toggle="tab" href="#calendar"><i class="fa fa-calendar"></i> Calendar view</a>
        </li>
      </ul>

      <div class="tab-content">
        <div id="home" class="tab-pane fade in active">
          <ul class="masonry media-grid" style="margin-top: 15px;">
            <% @events.each do |event| %>
                <%= render event %>
            <% end %>
          </ul>
        </div>
        <div id="map" class="tab-pane fade">
          <div id="map-content">
            <%= render :partial => "events/partials/events_map", :locals => {:events => @events} %>
          </div>
        </div>
        <div id="calendar" class="tab-pane fade">
          <div id="calendar-content">
            <br>
            <p class="h1">Calendar chart feature coming soon</p>
            <img style="width:100%" src="http://blogs.opentext.com/wp-content/uploads/2015/03/calendar-chart-preview.png"/>
            <%#= render :partial => "events/partials/events_calendar", :locals => {:events => @events} %>
          </div>
        </div>
      </div>

      <!--<div class="row event-grid" style="background-color: #eeeeee;">-->
      <!--&lt;!&ndash;<#%= render :partial => "tab_headings", :locals => {:selected_tab => "grid"} %>&ndash;&gt;-->
      <!--&lt;!&ndash; ACTUAL RESULTS LIST &ndash;&gt;-->
      <!--<#% @events.each do |event| %>-->
      <!--<#%= render event %>-->
      <!--<#% end %>-->
      <!--</div>-->

      <!-- Alternative Map view -->
      <!--<div id="map-content" class="tab-content">-->
      <!--<#%= render :partial => "map_view", :locals => {:events => @events} %>-->
      <!--</div>-->
  <% end %>
  </div>
</div>
