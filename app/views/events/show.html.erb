<script>
    function initMap() {
        var myLatLng = {lat: <%=@event.latitude%>, lng: <%=@event.longitude%>};

        // Create a map object and specify the DOM element for display.
        var map = new google.maps.Map(document.getElementById('map'), {
            center: myLatLng,
            scrollwheel: true,
            zoom: 5
        });

        // Create a marker and set its position.
        var marker = new google.maps.Marker({
            map: map,
            position: myLatLng,
            title: '<%= @event.title %>'
        });
    }

    $(document).ready(function(){
        $.getScript("https://maps.googleapis.com/maps/api/js?key=AIzaSyCT1w2S_2I49FwJDKHGj9A9sO86Lp9nUdg&callback=initMap")
    })
</script>
<script>
  $(document).ready(function () {
    reposition_tiles('masonry', 'masonry-brick');
    $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
      reposition_tiles('masonry', 'masonry-brick');
    })
  })
</script>
<div class="wrapper collapsing-wrapper">
  <!-- SIDEBAR -->
  <div class="collapsing-sidebar" id="sidebar">
    <%= render :partial => "content_providers/partials/content_provider_info", :locals => {:content_provider => @event.content_provider} %>
  </div>
  <div id="content">
    <div class="row">
      <div class="content_action">
        <%= link_to t('.back', :default => t("helpers.links.back")),
                    :back, :class => 'btn btn-info'  %>
        <% if !current_user.nil? and policy(@event).update? %>
            <%= link_to 'Edit', edit_event_path(@event), :class=>"btn btn-primary" %>
        <% end %>
        <% if !current_user.nil? and policy(@event).destroy? %>
            <%= link_to t('.destroy', :default => t("helpers.links.destroy")),
                        event_path(@event),
                        :method => 'delete',
                        :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) },
                        :class => 'btn btn-danger' %>
        <% end %>
        <a href="<%= @event.url %>" target="_blank" class="btn btn-success"><span class="fa fa-external-link"></span> View event</a>
      </div>
    </div>
    <div class="row">
      <ul class="nav nav-tabs">
        <li class="active">
          <a data-toggle="tab" href="#home"><i class="<%= icon_class_for_model('events') %>"></i> Event</a>
        </li>
        <li>
          <a data-toggle="tab" href="#packages"><i class="<%= icon_class_for_model('packages') %>"></i> Packages</a>
        </li>
        <li>
          <a data-toggle="tab" href="#activity_log"><i class="<%= icon_class_for_model('activity_logs') %>"></i> Activity log</a>
        </li>
      </ul>

      <div class="tab-content">
        <div id="home" class="tab-pane fade in active">
          <div class="row">
            <div class="page-header">
              <h2><%= @event.title %></h2>
              <p><%= link_to @event.url, @event.url, :class =>'h5', :target => "_blank" %></p>
            </div>
            <div class="col-md-4">
              <% if @event.provider and !@event.provider.blank? %>
                  <p><strong>Provider:</strong>
                    <%= @event.provider %></p>
              <% end %>

              <% if @event.field and !@event.field.empty? %>
                  <p><strong>Field:</strong>
                    <%= @event.field.join(', ')%></p>
              <% end %>


              <% if @event.description and !@event.description.blank? %>
                  <p><strong>Description:</strong>
                    <%= @event.description %></p>
              <% end %>

              <% if @event.category and !@event.category.empty? %>
                  <p><strong>Category:</strong>
                    <%= @event.category.join(', ') %></p>
              <% end %>

              <% if @event.start and !@event.start.blank? %>
                  <p><strong>Start:</strong>
                    <%= @event.start %></p>
              <% end %>

              <% if @event.end and !@event.end.blank? %>
                  <p><strong>End:</strong>
                    <%= @event.end %></p>
              <% end %>

              <% if @event.sponsor and !@event.sponsor.blank? %>
                  <p><strong>Sponsor:</strong>
                    <%= @event.sponsor %></p>
              <% end %>

              <% if @event.venue and !@event.venue.blank? %>
                  <p><strong>Venue:</strong>
                    <%= @event.venue %></p>
              <% end %>

              <% if @event.city and !@event.city.blank? %>
                  <p><strong>City:</strong>
                    <%= @event.city %></p>
              <% end %>

              <% if @event.county and !@event.county.blank? %>
                  <p><strong>County:</strong>
                    <%= @event.county %></p>
              <% end %>

              <% if @event.country and !@event.country.blank? %>
                  <p><strong>Country:</strong>
                    <%= @event.country %></p>
              <% end %>

              <% if @event.postcode and !@event.postcode.blank? %>
                  <p><strong>Postcode:</strong>
                    <%= @event.postcode %></p>
              <% end %>

              <% if @event.external_resources.any? %>
                  <b>External resources: </b>
                  <%= render partial: 'common/external_resources_list', locals: { external_resources: @event.external_resources } %>
              <% end %>

              <%= render :partial => 'events/partials/event_schemaorg', :locals => {:event => @event} %>

              <!--<%# if @event.latitude and !@event.latitude.blank? %>-->
              <!--<p><strong>Latitude:</strong>
                  <%#= @event.latitude %></p> -->
              <!--<%# end %>-->
              <!--<%# if @event.longitude and !@event.longitude.blank? %>-->
              <!--<p><strong>Longitude:</strong>
                  <%#= @event.longitude %></p> -->
              <!--<%# end %>-->
            </div>
            <div class="col-md-8">
              <div id="map" class="event-show-map"></div>
            </div>
          </div>
          <div class="col-md-8">
            <%= link_to 'Download', "/events/#{@event.id}/get_ics", :class=>"btn btn-info" %>
          </div>
        </div>
        <div id="activity_log" class="tab-pane fade">
          <%= render :partial => "activities/activity_log", :locals => {:resource => @event} %>
        </div>
        <div id="packages" class="tab-pane fade">
          <!--<%# if !current_user.nil? and policy(@event).update? %>-->
              <!--<div class="row">-->
                <!--<%#= form_tag(controller: 'events', id: @event.id, action: 'update_packages', method: 'post') do |f| %>-->
                    <!--<%#= render :partial => 'common/dropdown', :locals => {:field_name => 'package', :resource => @event, :f => f, :options => available_packages(@event), :dropdown_toggle_button_name => "Add to package"} %>-->
                    <!--<button type="submit" value="add" class="btn btn-primary">Update event</button>-->
                <!--<%# end %>-->
              <!--</div>-->
          <!--<%# end %>-->
          <div class="row">
            <% if @event.packages.blank? %>
                <%= empty_tag(:p, 'This event is currently not included in any packages.', "padding-top: 10px;") %>
            <% else %>
                <ul class="masonry media-grid">
                  <% @event.packages.each do |package| %>
                      <%= render :partial => "packages/package", :locals => {:package => package} %>
                  <% end %>
                </ul>
            <% end %>
          </div>

        </div>
      </div>
    </div>
  </div>
</div>
