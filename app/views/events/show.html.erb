<div class="wrapper collapsing-wrapper">
  <%# SIDEBAR %>
  <div class="collapsing-sidebar" id="sidebar">
    <%= render partial: 'content_providers/partials/content_provider_info', locals: { content_provider: @event.content_provider } %>
    <%= render partial: "nodes/partials/associated_node_info", locals: { associated_nodes: @event.associated_nodes } %>
    <%= render(partial: 'users/partials/user_info', locals: { user: @event.user }) if current_user.try(:is_admin?) %>
  </div>

  <div id="content">
    <div id="home" class="row">
      <div class="page-header">
        <% if @event.event_types.any? %>
          <% @event.event_types.each do |t| %>
            <div class="sub-heading"><%= EventTypeDictionary.instance.lookup_value(t, 'title') %></div>
          <% end %>
        <% end %>

        <!--          TODO: refactor event type using...-->
        <%#= render :partial => 'events/partials/icon_info' %>
        <h2 class="mt-0">
          <% if @event.has_node? -%>
            <%= image_tag 'elixir/elixir_logo_orange.png',
                          :alt => 'Elixir node event',
                          :title => 'Elixir node event',
                          :style => 'height: 40px;' %>
          <% end -%>

          <% if @event.online? %>
            <i class="icon icon-h2 virtual-event-icon"></i>
          <% else %>
            <i class="icon icon-h2 onsite-event-icon"></i>
          <% end %>

          <%= @event.title %>

          <% if current_user&.is_admin? %>
            <%= missing_icon(@event, 'large') %>
            <%= scrape_status_icon(@event, 'large') %>
            <%= suggestion_icon(@event, 'large') -%>
          <% end %>
        </h2>
        <p><%= @event.subtitle %></p>
        <!--          TODO: add css pseudoclass "a.external:after" with the icon-->
        <p><%= link_to @event.url, target: '_blank', rel: 'noopener', onclick: "getOutboundLink('#{@event.url}'); return true;" do %>
            <%= @event.url %><i class="icon icon-md arrow-top-right-icon"></i>
          <% end %>

        </p>
      </div>

      <div class="md-col-12">
        <div class="content_action">
          <%= star_button(@event) if user_signed_in? %>
          <%= render partial: 'common/identifiers_dot_org_button', locals: { resource: @event } if TeSS::Config.identifiers_prefix %>
          <% if @event.start && @event.end %>
            <div class="btn-group">
              <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Add to calendar <span class="caret"></span>
              </button>
              <ul class="dropdown-menu">
                <li>
                  <%= link_to google_calendar_export_url(@event), target: '_blank', rel: 'noopener' do %>
                    <i class="fa fa-google"></i> Google Calendar
                  <% end %>
                </li>
                <li>
                  <%= link_to event_path(@event, format: :ics) do %>
                    <i class="<%= icon_class_for_model('events') -%>"></i> Save event (.ics file)
                  <% end %>
                </li>
              </ul>
            </div>
          <% end %>
          <% if !current_user.nil? and policy(@event).update? %>
            <%= link_to 'Clone', clone_event_path(@event), :class => "btn btn-default" %>
            <%= link_to 'Edit', edit_event_path(@event), :class => "btn btn-primary" %>
          <% end %>
          <% if !current_user.nil? and policy(@event).destroy? %>
            <%= link_to t('.destroy', :default => t("helpers.links.destroy")),
                        event_path(@event),
                        :method => 'delete',
                        :data => { :confirm => t('.confirm', :default => t("helpers.l inks.confirm", :default => 'Are you sure?')) },
                        :class => 'btn btn-danger' %>
          <% end %>
        </div>
      </div>

      <div class="row">
        <%= google_maps_javascript_api_tag(@event) if @event.show_map? %>

        <!-- Field: description -->
        <% if @event.description.present? %>
          <div class="description">
            <%= render_markdown @event.description %>
          </div>
        <% end %>

        <!-- Field: start and end -->
        <%= display_attribute(@event, :start) { |t| t.strftime('%A, %d %B %Y @ %H:%M') }%>
        <%= display_attribute(@event, :end) { |t| t.strftime('%A, %d %B %Y @ %H:%M') } %>
        <%= display_attribute(@event, :timezone) %>
        <%= display_attribute(@event, :duration) %>
      </div>

      <div>
        <%= render partial: 'common/extra_metadata', locals: { resource: @event } %>

        <!-- Field: external resources -->
        <% if @event.external_resources.any? %>
          <strong class="text-primary">External resources:</strong>
          <%= render partial: 'common/external_resources_list',
                     locals: { external_resources: @event.external_resources } %>
        <% end %>

        <!-- Field: material -->
        <% if @event.materials.any? %>
          <div>
            <strong class="text-primary">Related training materials: </strong>
            <ul>
              <% @event.materials.each do |material| %>
                <li><%= link_to material.title, material %></li>
              <% end %>
            </ul>
          </div>
        <% end %>

        <%= render partial: 'events/partials/twitter_card', locals: { event: @event } %>

        <%= render partial: 'events/report' if policy(@event).view_report? %>

        <% if policy(@event).update? && @event.edit_suggestion %>
          <%= render partial: 'common/approve_term_suggestions',
                     locals: { suggestion: @event.edit_suggestion } %>
        <% end %>

      </div>
    </div>

    <%= render partial: 'activities/activity_log_button', locals: { resource: @event } %>
  </div>
</div>
